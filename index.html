<html lang="cn">
  <head>
    <style>
      html,
      body {
        margin: 0;
      }

      #div {
        width: 200px;
        height: 200px;
        background-color: red;
      }
      canvas {
        display: block;
      }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Exercise</title>
  </head>
  <body>
    <canvas></canvas>
    <script>
      var canvas = document.querySelector("canvas");
      var context = canvas.getContext("2d");

      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }

      // 初始化 Canvas 大小
      resizeCanvas();

      // 监听窗口大小变化，动态调整 Canvas 大小
      window.addEventListener("resize", resizeCanvas);
    </script>
    <!--    <script >-->
    <!--      const element = document.getElementById("div");-->
    <!--      let start, previousTimeStamp;-->
    <!--      let done = false;-->

    <!--      function step(timeStamp) {-->
    <!--        if (start === undefined) {-->
    <!--          start = timeStamp;-->
    <!--        }-->
    <!--        const elapsed = timeStamp - start;-->

    <!--        if (previousTimeStamp !== timeStamp) {-->
    <!--          // Math.min() is used here to make sure the element stops at exactly 200px-->
    <!--          const count = Math.min(0.1 * elapsed, 200);-->
    <!--          element.style.transform = `translateX(${count}px)`;-->
    <!--          if (count === 200) done = true;-->
    <!--        }-->

    <!--        if (elapsed < 2000) {-->
    <!--          // Stop the animation after 2 seconds-->
    <!--          previousTimeStamp = timeStamp;-->
    <!--          if (!done) {-->
    <!--            window.requestAnimationFrame(step);-->
    <!--          }-->
    <!--        }-->
    <!--      }-->

    <!--      window.requestAnimationFrame(step);-->
    <!--    </script>-->
    <script type="application/javascript">
      let start, previousTimeStamp;
      let posX = 10,
        blockWidth = 10,
        animationId,
        isAnimating = false,
        v = 100;

      const canvas = document.querySelector("canvas");
      const ctx = canvas.getContext("2d");
      ctx.fillStyle = "green";
      ctx.fillRect(10, 10, 10, 10);
      const cb = (timeStamp) => {
        if (start === undefined) {
          start = timeStamp;
        }

        const delta = (timeStamp - (previousTimeStamp || 0)) / 1000;

        const count = v * delta;
        posX += count;
        console.log(posX, "posx", ctx.canvas.width, v);
        if (posX >= ctx.canvas.width - blockWidth || posX <= 0) {
          v = -v;
        }

        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
        ctx.fillRect(posX, 10, blockWidth, 10);
        previousTimeStamp = timeStamp;
        if (isAnimating) {
          animationId = window.requestAnimationFrame(cb);
        }
      };

      startAnimation();

      function stopAnimation() {
        if (isAnimating) {
          isAnimating = false;
        }
        animationId && window.cancelAnimationFrame(animationId);
      }
      function startAnimation() {
        if (!isAnimating) {
          isAnimating = true;
        }
        animationId = window.requestAnimationFrame(cb);
      }

      document.addEventListener("visibilitychange", () => {
        console.log("vvvv", document.hidden, animationId);

        if (document.hidden) {
          stopAnimation();
        } else {
          // startAnimation();
        }
      });
    </script>
    <!--    <script type="application/javascript">-->
    <!--      const canvas = document.querySelector("canvas");-->
    <!--      const ctx = canvas.getContext("2d");-->
    <!--      // ctx.fillStyle = "green";-->
    <!--      ctx.beginPath();-->
    <!--      ctx.arc(120, 120, 100, 0, Math.PI * 2);-->
    <!--      ctx.fillStyle = "red";-->
    <!--      ctx.fill();-->
    <!--      ctx.lineWidth=20; // 包括在圆内-->
    <!--      ctx.strokeStyle = "yellow";-->
    <!--      ctx.stroke();-->
    <!--      // ctx.fillRect(10, 10, 200, 200);-->
    <!--    </script>-->
  </body>
</html>
