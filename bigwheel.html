<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Canvas Wheel</title>

    <style>
      canvas {
        width: 100%;
        top: 0px;
        position: relative;
      }
    </style>
  </head>
  <body>
    <canvas id="wheel" width="400" height="400"></canvas>
    <script>
      var canvas = document.getElementById("wheel");
      var ctx = canvas.getContext("2d");
      var colors = ["#FF0000", "#00FF00", "#0000FF", "#FFFF00"];
      var numSegments = colors.length;
      var angle = 0;
      var spinSpeed = 0;

      function drawWheel() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        var radius = canvas.width / 2 - 10;
        var center = canvas.width / 2;

        for (var i = 0; i < numSegments; i++) {
          ctx.beginPath();
          ctx.moveTo(center, center);
          ctx.arc(
            center,
            center,
            radius,
            angle + -Math.PI / 2,
            angle + -Math.PI / 2 + (2 * Math.PI) / numSegments,
            false,
          );
          // ctx.lineTo(center, center);
          ctx.closePath();
          ctx.fillStyle = colors[i];
          ctx.fill();
          angle += (2 * Math.PI) / numSegments;
        }

        // 画一个中心圆
        ctx.beginPath();
        ctx.arc(center, center, 20, 0, 2 * Math.PI, false);
        ctx.fillStyle = "#FFFFFF";
        ctx.fill();
      }

      var initialSpeed = 0.15; // 初始速度
      var friction = 0.998; // 摩擦系数，越接近1，减速越慢
      var spinSpeed = 0; // 旋转速度
      var targetSegment = 2; // 目标扇叶

      canvas.addEventListener(
        "click",
        function () {
          if (spinSpeed <= 0) {
            // 起始旋转速度
            spinSpeed = initialSpeed;
          }
        },
        false,
      );

      function spinWheel() {
        // 计算目标角度
        var targetAngle =
          2 * Math.PI - ((2 * Math.PI) / numSegments) * targetSegment;

        // 在接近目标角度时进一步减小摩擦系数
        var distanceToTarget = Math.abs(targetAngle - (angle % (2 * Math.PI)));
        if (spinSpeed < 0.005 && distanceToTarget < 0.05) {
          spinSpeed *= 0.95; // 更大的摩擦
        }

        angle += spinSpeed;

        // 摩擦力减速
        spinSpeed *= friction;

        // 如果速度足够小并且接近目标，停止旋转
        if (spinSpeed < 0.0001 && distanceToTarget < 0.005) {
          angle = targetAngle; // 精确对齐
          spinSpeed = 0;
        }

        drawWheel();
        requestAnimationFrame(spinWheel);
      }

      // 初始化转盘
      drawWheel();
      // 启动动画
      spinWheel();
    </script>
  </body>
</html>
